{"ast":null,"code":"// import React, { useState } from \"react\";\n// import axios from \"axios\";\n// function AddUser() {\n//   const [name, setName] = useState(\"\");\n//   const [email, setEmail] = useState(\"\");\n//   const handleSubmit = async (e) => {\n//     e.preventDefault();\n//     try {\n//       await axios.post(\"http://localhost:3000/users\", { name, email });\n//       alert(\"Thêm user thành công!\");\n//       setName(\"\");\n//       setEmail(\"\");\n//     } catch (error) {\n//       console.error(\"Lỗi khi thêm user:\", error);\n//     }\n//   };\n//   return (\n//     <div>\n//       <h2>Thêm người dùng</h2>\n//       <form onSubmit={handleSubmit}>\n//         <input\n//           type=\"text\"\n//           placeholder=\"Tên\"\n//           value={name}\n//           onChange={(e) => setName(e.target.value)}\n//           required\n//         />\n//         <input\n//           type=\"email\"\n//           placeholder=\"Email\"\n//           value={email}\n//           onChange={(e) => setEmail(e.target.value)}\n//           required\n//         />\n//         <button type=\"submit\">Thêm</button>\n//       </form>\n//     </div>\n//   );\n// }\n// export default AddUser;\nimport React,{useState}from\"react\";import axios from\"axios\";import Modal from\"./components/Modal\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API=process.env.REACT_APP_API_URL||\"http://localhost:3000\";export default function AddUser(_ref){let{onAdded,token,currentUser}=_ref;const[name,setName]=useState(\"\");const[email,setEmail]=useState(\"\");const[role,setRole]=useState('user');const[submitting,setSubmitting]=useState(false);const[modalOpen,setModalOpen]=useState(false);// modal tạo user\nconst[noticeOpen,setNoticeOpen]=useState(false);// modal thông báo\nconst[modalMsg,setModalMsg]=useState(\"\");const handleSubmit=async e=>{e.preventDefault();// Validation cơ bản\nconst trimmedName=name.trim();const trimmedEmail=email.trim();const emailRegex=/^\\S+@\\S+\\.[\\S]+$/;if(!trimmedName){alert('Name không được để trống');return;}if(!emailRegex.test(trimmedEmail)){alert('Email không hợp lệ');return;}try{setSubmitting(true);const config=token?{headers:{Authorization:\"Bearer \".concat(token)}}:{};const payload={name:trimmedName,email:trimmedEmail};if((currentUser===null||currentUser===void 0?void 0:currentUser.role)==='admin'&&role)payload.role=role;const response=await axios.post(\"\".concat(API,\"/users\"),payload,config);console.log('Response:',response.data);setName(\"\");setEmail(\"\");setRole('user');if(onAdded)onAdded();// báo parent refresh danh sách\nsetModalMsg('Thêm user thành công!');setNoticeOpen(true);}catch(err){var _err$response,_err$response$data,_err$response2,_err$response2$data;console.error('Add user error:',err);const msg=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.message)||err.message;// Bắt lỗi trùng email (MongoDB E11000)\nif(typeof msg==='string'&&msg.toLowerCase().includes('duplicate')){setModalMsg('Email đã tồn tại, vui lòng dùng email khác.');setNoticeOpen(true);}else{setModalMsg(\"Th\\xEAm th\\u1EA5t b\\u1EA1i: \".concat(msg));setNoticeOpen(true);}}finally{setSubmitting(false);}};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",type:\"button\",onClick:()=>setModalOpen(true),children:\"Th\\xEAm ng\\u01B0\\u1EDDi d\\xF9ng\"}),/*#__PURE__*/_jsx(Modal,{open:modalOpen,title:\"Th\\xEAm ng\\u01B0\\u1EDDi d\\xF9ng\",onClose:()=>setModalOpen(false),children:/*#__PURE__*/_jsxs(\"form\",{className:\"user-form\",onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:name,onChange:e=>setName(e.target.value),placeholder:\"H\\u1ECD v\\xE0 t\\xEAn\",required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input\",value:email,onChange:e=>setEmail(e.target.value),placeholder:\"Gmail\",type:\"email\",required:true})}),(currentUser===null||currentUser===void 0?void 0:currentUser.role)==='admin'&&/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsxs(\"select\",{className:\"input\",value:role,onChange:e=>setRole(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"user\",children:\"User\"}),/*#__PURE__*/_jsx(\"option\",{value:\"moderator\",children:\"Moderator\"}),/*#__PURE__*/_jsx(\"option\",{value:\"admin\",children:\"Admin\"})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'flex-end',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn small\",onClick:()=>setModalOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",type:\"submit\",disabled:submitting,children:submitting?'Đang thêm...':'Thêm'})]})]})}),/*#__PURE__*/_jsx(Modal,{open:noticeOpen,title:\"Th\\xF4ng b\\xE1o\",message:modalMsg,onClose:()=>setNoticeOpen(false)})]});}","map":{"version":3,"names":["React","useState","axios","Modal","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API","process","env","REACT_APP_API_URL","AddUser","_ref","onAdded","token","currentUser","name","setName","email","setEmail","role","setRole","submitting","setSubmitting","modalOpen","setModalOpen","noticeOpen","setNoticeOpen","modalMsg","setModalMsg","handleSubmit","e","preventDefault","trimmedName","trim","trimmedEmail","emailRegex","alert","test","config","headers","Authorization","concat","payload","response","post","console","log","data","err","_err$response","_err$response$data","_err$response2","_err$response2$data","error","msg","message","toLowerCase","includes","children","className","type","onClick","open","title","onClose","onSubmit","value","onChange","target","placeholder","required","style","display","justifyContent","gap","disabled"],"sources":["d:/PM MNM/group11-project1/frontend/src/AddUser.jsx"],"sourcesContent":["// import React, { useState } from \"react\";\n// import axios from \"axios\";\n\n// function AddUser() {\n//   const [name, setName] = useState(\"\");\n//   const [email, setEmail] = useState(\"\");\n\n//   const handleSubmit = async (e) => {\n//     e.preventDefault();\n//     try {\n//       await axios.post(\"http://localhost:3000/users\", { name, email });\n//       alert(\"Thêm user thành công!\");\n//       setName(\"\");\n//       setEmail(\"\");\n//     } catch (error) {\n//       console.error(\"Lỗi khi thêm user:\", error);\n//     }\n//   };\n\n//   return (\n//     <div>\n//       <h2>Thêm người dùng</h2>\n//       <form onSubmit={handleSubmit}>\n//         <input\n//           type=\"text\"\n//           placeholder=\"Tên\"\n//           value={name}\n//           onChange={(e) => setName(e.target.value)}\n//           required\n//         />\n//         <input\n//           type=\"email\"\n//           placeholder=\"Email\"\n//           value={email}\n//           onChange={(e) => setEmail(e.target.value)}\n//           required\n//         />\n//         <button type=\"submit\">Thêm</button>\n//       </form>\n//     </div>\n//   );\n// }\n\n// export default AddUser;\n\nimport React, { useState } from \"react\";\nimport axios from \"axios\";\nimport Modal from \"./components/Modal\";\n\nconst API = process.env.REACT_APP_API_URL || \"http://localhost:3000\";\n\nexport default function AddUser({ onAdded, token, currentUser }) {\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [role, setRole] = useState('user');\n  const [submitting, setSubmitting] = useState(false);\n  const [modalOpen, setModalOpen] = useState(false); // modal tạo user\n  const [noticeOpen, setNoticeOpen] = useState(false); // modal thông báo\n  const [modalMsg, setModalMsg] = useState(\"\");\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    // Validation cơ bản\n    const trimmedName = name.trim();\n    const trimmedEmail = email.trim();\n    const emailRegex = /^\\S+@\\S+\\.[\\S]+$/;\n\n    if (!trimmedName) {\n      alert('Name không được để trống');\n      return;\n    }\n    if (!emailRegex.test(trimmedEmail)) {\n      alert('Email không hợp lệ');\n      return;\n    }\n\n    try {\n      setSubmitting(true);\n      const config = token ? { headers: { Authorization: `Bearer ${token}` } } : {};\n  const payload = { name: trimmedName, email: trimmedEmail };\n  if (currentUser?.role === 'admin' && role) payload.role = role;\n  const response = await axios.post(`${API}/users`, payload, config);\n      console.log('Response:', response.data);\n      setName(\"\");\n      setEmail(\"\");\n  setRole('user');\n      if (onAdded) onAdded(); // báo parent refresh danh sách\n      setModalMsg('Thêm user thành công!');\n      setNoticeOpen(true);\n    } catch (err) {\n      console.error('Add user error:', err);\n      const msg = err.response?.data?.error || err.response?.data?.message || err.message;\n      // Bắt lỗi trùng email (MongoDB E11000)\n      if (typeof msg === 'string' && msg.toLowerCase().includes('duplicate')) {\n        setModalMsg('Email đã tồn tại, vui lòng dùng email khác.');\n        setNoticeOpen(true);\n      } else {\n        setModalMsg(`Thêm thất bại: ${msg}`);\n        setNoticeOpen(true);\n      }\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <>\n      <button className=\"btn small\" type=\"button\" onClick={() => setModalOpen(true)}>Thêm người dùng</button>\n\n      <Modal open={modalOpen} title=\"Thêm người dùng\" onClose={() => setModalOpen(false)}>\n        <form className=\"user-form\" onSubmit={handleSubmit}>\n          <div className=\"form-group\">\n            <input className=\"input\" value={name} onChange={e=>setName(e.target.value)} placeholder=\"Họ và tên\" required />\n          </div>\n          <div className=\"form-group\">\n            <input className=\"input\" value={email} onChange={e=>setEmail(e.target.value)} placeholder=\"Gmail\" type=\"email\" required />\n          </div>\n          {currentUser?.role === 'admin' && (\n            <div className=\"form-group\">\n              <select className=\"input\" value={role} onChange={e=>setRole(e.target.value)}>\n                <option value=\"user\">User</option>\n                <option value=\"moderator\">Moderator</option>\n                <option value=\"admin\">Admin</option>\n              </select>\n            </div>\n          )}\n          <div style={{display:'flex',justifyContent:'flex-end',gap:8}}>\n            <button type=\"button\" className=\"btn small\" onClick={() => setModalOpen(false)}>Hủy</button>\n            <button className=\"btn small\" type=\"submit\" disabled={submitting}>{submitting ? 'Đang thêm...' : 'Thêm'}</button>\n          </div>\n        </form>\n      </Modal>\n\n      <Modal open={noticeOpen} title=\"Thông báo\" message={modalMsg} onClose={() => setNoticeOpen(false)} />\n    </>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}