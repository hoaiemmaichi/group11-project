{"ast":null,"code":"import React,{useState}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API=process.env.REACT_APP_API_URL||'http://localhost:3000';export default function Login(_ref){let{onLogin,onForgot,onReset,notice}=_ref;// Cờ để ẩn/hiện khu vực \"Quên mật khẩu?\" và \"Đổi mật khẩu bằng token\" trong form đăng nhập.\n// Đặt về true nếu muốn hiển thị lại sau này. Hiện tại để false để ẩn theo yêu cầu.\nconst SHOW_RECOVERY_LINKS=true;// hiện tại hiển thị lại theo yêu cầu\nconst[email,setEmail]=useState('');const[password,setPassword]=useState('');const[loading,setLoading]=useState(false);const[message,setMessage]=useState('');const handleSubmit=async e=>{e.preventDefault();setMessage('');setLoading(true);try{console.log('Login: sending to',\"\".concat(API,\"/auth/login\"),{email});const res=await axios.post(\"\".concat(API,\"/auth/login\"),{email,password});const token=res.data.token;const refreshToken=res.data.refreshToken;const user=res.data.user;if(token){try{localStorage.setItem('token',token);}catch(_){}if(refreshToken){try{localStorage.setItem('refreshToken',refreshToken);}catch(_){}}if(user){try{localStorage.setItem('currentUser',JSON.stringify(user));}catch(_){}}if(onLogin)onLogin(token,user,refreshToken);setMessage('Đăng nhập thành công');}else{setMessage('Không nhận được token');}}catch(err){var _err$response,_err$response$data,_err$response2;console.error('Login error',err);const serverMsg=((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.message)||((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.data)||null;setMessage(serverMsg||err.message||'Lỗi đăng nhập');}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"form\",{className:\"user-form\",onSubmit:handleSubmit,children:[notice&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:8,padding:'8px 10px',background:'#e8f5e9',color:'#2e7d32',border:'1px solid #c8e6c9',borderRadius:8},children:notice}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input\",placeholder:\"Email\",type:\"email\",value:email,onChange:e=>setEmail(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-group\",children:/*#__PURE__*/_jsx(\"input\",{className:\"input\",placeholder:\"M\\u1EADt kh\\u1EA9u\",type:\"password\",value:password,onChange:e=>setPassword(e.target.value),required:true})}),/*#__PURE__*/_jsx(\"button\",{className:\"btn\",type:\"submit\",disabled:loading,children:loading?'Đang...':'Đăng nhập'}),SHOW_RECOVERY_LINKS&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',marginTop:8},children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn link\",onClick:onForgot,children:\"Qu\\xEAn m\\u1EADt kh\\u1EA9u?\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn link\",onClick:onReset,children:\"\\u0110\\u1ED5i m\\u1EADt kh\\u1EA9u b\\u1EB1ng token\"})]}),message&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8,color:'#c62828'},children:message})]});}","map":{"version":3,"names":["React","useState","axios","jsx","_jsx","jsxs","_jsxs","API","process","env","REACT_APP_API_URL","Login","_ref","onLogin","onForgot","onReset","notice","SHOW_RECOVERY_LINKS","email","setEmail","password","setPassword","loading","setLoading","message","setMessage","handleSubmit","e","preventDefault","console","log","concat","res","post","token","data","refreshToken","user","localStorage","setItem","_","JSON","stringify","err","_err$response","_err$response$data","_err$response2","error","serverMsg","response","className","onSubmit","children","style","marginBottom","padding","background","color","border","borderRadius","placeholder","type","value","onChange","target","required","disabled","display","justifyContent","marginTop","onClick"],"sources":["d:/PM MNM/group11-project1/frontend/src/Login.jsx"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\n\nconst API = process.env.REACT_APP_API_URL || 'http://localhost:3000';\n\nexport default function Login({ onLogin, onForgot, onReset, notice }) {\n  // Cờ để ẩn/hiện khu vực \"Quên mật khẩu?\" và \"Đổi mật khẩu bằng token\" trong form đăng nhập.\n  // Đặt về true nếu muốn hiển thị lại sau này. Hiện tại để false để ẩn theo yêu cầu.\n  const SHOW_RECOVERY_LINKS = true; // hiện tại hiển thị lại theo yêu cầu\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState('');\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setMessage('');\n    setLoading(true);\n    try {\n      console.log('Login: sending to', `${API}/auth/login`, { email });\n      const res = await axios.post(`${API}/auth/login`, { email, password });\n      const token = res.data.token;\n      const refreshToken = res.data.refreshToken;\n      const user = res.data.user;\n      if (token) {\n        try { localStorage.setItem('token', token); } catch(_){}\n        if (refreshToken) { try { localStorage.setItem('refreshToken', refreshToken); } catch(_){} }\n        if (user) {\n          try { localStorage.setItem('currentUser', JSON.stringify(user)); } catch (_) {}\n        }\n        if (onLogin) onLogin(token, user, refreshToken);\n        setMessage('Đăng nhập thành công');\n      } else {\n        setMessage('Không nhận được token');\n      }\n    } catch (err) {\n      console.error('Login error', err);\n      const serverMsg = err.response?.data?.message || err.response?.data || null;\n      setMessage(serverMsg || err.message || 'Lỗi đăng nhập');\n    } finally { setLoading(false); }\n  };\n\n  return (\n    <form className=\"user-form\" onSubmit={handleSubmit}>\n      {notice && (\n        <div style={{\n          marginBottom: 8,\n          padding: '8px 10px',\n          background: '#e8f5e9',\n          color: '#2e7d32',\n          border: '1px solid #c8e6c9',\n          borderRadius: 8\n        }}>\n          {notice}\n        </div>\n      )}\n      <div className=\"form-group\">\n        <input className=\"input\" placeholder=\"Email\" type=\"email\" value={email} onChange={e=>setEmail(e.target.value)} required />\n      </div>\n      <div className=\"form-group\">\n        <input className=\"input\" placeholder=\"Mật khẩu\" type=\"password\" value={password} onChange={e=>setPassword(e.target.value)} required />\n      </div>\n      <button className=\"btn\" type=\"submit\" disabled={loading}>{loading ? 'Đang...' : 'Đăng nhập'}</button>\n      {SHOW_RECOVERY_LINKS && (\n        <div style={{display:'flex',justifyContent:'space-between',marginTop:8}}>\n          {/* Giữ nguyên code; kiểm soát hiển thị bằng cờ SHOW_RECOVERY_LINKS */}\n          <button type=\"button\" className=\"btn link\" onClick={onForgot}>Quên mật khẩu?</button>\n          <button type=\"button\" className=\"btn link\" onClick={onReset}>Đổi mật khẩu bằng token</button>\n        </div>\n      )}\n      {message && <div style={{marginTop:8,color:'#c62828'}}>{message}</div>}\n    </form>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}