{"ast":null,"code":"import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import axios from'../api';const API=process.env.REACT_APP_API_URL||'http://localhost:3000';// Thunk: login user (example usage)\nexport const loginUser=createAsyncThunk('auth/loginUser',async(_ref,_ref2)=>{let{email,password}=_ref;let{rejectWithValue}=_ref2;try{const res=await axios.post(\"\".concat(API,\"/auth/login\"),{email,password});return res.data;// expected { token, refreshToken, user }\n}catch(err){var _err$response;return rejectWithValue(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.data)||err.message);}});const initialState={token:typeof window!=='undefined'?localStorage.getItem('token'):null,refreshToken:typeof window!=='undefined'?localStorage.getItem('refreshToken'):null,user:(()=>{try{const r=localStorage.getItem('currentUser');return r?JSON.parse(r):null;}catch(e){return null;}})(),status:'idle',error:null};const authSlice=createSlice({name:'auth',initialState,reducers:{setCredentials(state,action){const{token,refreshToken,user}=action.payload||{};state.token=token||null;state.refreshToken=refreshToken||null;state.user=user||null;try{if(token)localStorage.setItem('token',token);else localStorage.removeItem('token');}catch(_){}try{if(refreshToken)localStorage.setItem('refreshToken',refreshToken);else localStorage.removeItem('refreshToken');}catch(_){}try{if(user)localStorage.setItem('currentUser',JSON.stringify(user));else localStorage.removeItem('currentUser');}catch(_){}},clearAuth(state){state.token=null;state.refreshToken=null;state.user=null;state.status='idle';state.error=null;try{localStorage.removeItem('token');localStorage.removeItem('refreshToken');localStorage.removeItem('currentUser');}catch(_){}}},extraReducers:builder=>{builder.addCase(loginUser.pending,state=>{state.status='loading';state.error=null;}).addCase(loginUser.fulfilled,(state,action)=>{state.status='succeeded';const{token,refreshToken,user}=action.payload||{};state.token=token||null;state.refreshToken=refreshToken||null;state.user=user||null;try{if(token)localStorage.setItem('token',token);}catch(_){}try{if(refreshToken)localStorage.setItem('refreshToken',refreshToken);}catch(_){}try{if(user)localStorage.setItem('currentUser',JSON.stringify(user));}catch(_){}}).addCase(loginUser.rejected,(state,action)=>{state.status='failed';state.error=action.payload||action.error.message;});}});export const{setCredentials,clearAuth}=authSlice.actions;export default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","API","process","env","REACT_APP_API_URL","loginUser","_ref","_ref2","email","password","rejectWithValue","res","post","concat","data","err","_err$response","response","message","initialState","token","window","localStorage","getItem","refreshToken","user","r","JSON","parse","e","status","error","authSlice","name","reducers","setCredentials","state","action","payload","setItem","removeItem","_","stringify","clearAuth","extraReducers","builder","addCase","pending","fulfilled","rejected","actions","reducer"],"sources":["d:/PM MNM/group11-project1/frontend/src/features/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport axios from '../api';\r\n\r\nconst API = process.env.REACT_APP_API_URL || 'http://localhost:3000';\r\n\r\n// Thunk: login user (example usage)\r\nexport const loginUser = createAsyncThunk(\r\n  'auth/loginUser',\r\n  async ({ email, password }, { rejectWithValue }) => {\r\n    try {\r\n      const res = await axios.post(`${API}/auth/login`, { email, password });\r\n      return res.data; // expected { token, refreshToken, user }\r\n    } catch (err) {\r\n      return rejectWithValue(err.response?.data || err.message);\r\n    }\r\n  }\r\n);\r\n\r\nconst initialState = {\r\n  token: typeof window !== 'undefined' ? localStorage.getItem('token') : null,\r\n  refreshToken: typeof window !== 'undefined' ? localStorage.getItem('refreshToken') : null,\r\n  user: (() => { try { const r = localStorage.getItem('currentUser'); return r ? JSON.parse(r) : null; } catch(e) { return null; } })(),\r\n  status: 'idle',\r\n  error: null,\r\n};\r\n\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    setCredentials(state, action) {\r\n      const { token, refreshToken, user } = action.payload || {};\r\n      state.token = token || null;\r\n      state.refreshToken = refreshToken || null;\r\n      state.user = user || null;\r\n      try { if (token) localStorage.setItem('token', token); else localStorage.removeItem('token'); } catch(_) {}\r\n      try { if (refreshToken) localStorage.setItem('refreshToken', refreshToken); else localStorage.removeItem('refreshToken'); } catch(_) {}\r\n      try { if (user) localStorage.setItem('currentUser', JSON.stringify(user)); else localStorage.removeItem('currentUser'); } catch(_) {}\r\n    },\r\n    clearAuth(state) {\r\n      state.token = null;\r\n      state.refreshToken = null;\r\n      state.user = null;\r\n      state.status = 'idle';\r\n      state.error = null;\r\n      try { localStorage.removeItem('token'); localStorage.removeItem('refreshToken'); localStorage.removeItem('currentUser'); } catch(_) {}\r\n    }\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      .addCase(loginUser.pending, (state) => { state.status = 'loading'; state.error = null; })\r\n      .addCase(loginUser.fulfilled, (state, action) => {\r\n        state.status = 'succeeded';\r\n        const { token, refreshToken, user } = action.payload || {};\r\n        state.token = token || null;\r\n        state.refreshToken = refreshToken || null;\r\n        state.user = user || null;\r\n        try { if (token) localStorage.setItem('token', token); } catch(_) {}\r\n        try { if (refreshToken) localStorage.setItem('refreshToken', refreshToken); } catch(_) {}\r\n        try { if (user) localStorage.setItem('currentUser', JSON.stringify(user)); } catch(_) {}\r\n      })\r\n      .addCase(loginUser.rejected, (state, action) => { state.status = 'failed'; state.error = action.payload || action.error.message; });\r\n  }\r\n});\r\n\r\nexport const { setCredentials, clearAuth } = authSlice.actions;\r\nexport default authSlice.reducer;\r\n"],"mappings":"AAAA,OAASA,WAAW,CAAEC,gBAAgB,KAAQ,kBAAkB,CAChE,MAAO,CAAAC,KAAK,KAAM,QAAQ,CAE1B,KAAM,CAAAC,GAAG,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,CAEpE;AACA,MAAO,MAAM,CAAAC,SAAS,CAAGN,gBAAgB,CACvC,gBAAgB,CAChB,MAAAO,IAAA,CAAAC,KAAA,GAAoD,IAA7C,CAAEC,KAAK,CAAEC,QAAS,CAAC,CAAAH,IAAA,IAAE,CAAEI,eAAgB,CAAC,CAAAH,KAAA,CAC7C,GAAI,CACF,KAAM,CAAAI,GAAG,CAAG,KAAM,CAAAX,KAAK,CAACY,IAAI,IAAAC,MAAA,CAAIZ,GAAG,gBAAe,CAAEO,KAAK,CAAEC,QAAS,CAAC,CAAC,CACtE,MAAO,CAAAE,GAAG,CAACG,IAAI,CAAE;AACnB,CAAE,MAAOC,GAAG,CAAE,KAAAC,aAAA,CACZ,MAAO,CAAAN,eAAe,CAAC,EAAAM,aAAA,CAAAD,GAAG,CAACE,QAAQ,UAAAD,aAAA,iBAAZA,aAAA,CAAcF,IAAI,GAAIC,GAAG,CAACG,OAAO,CAAC,CAC3D,CACF,CACF,CAAC,CAED,KAAM,CAAAC,YAAY,CAAG,CACnBC,KAAK,CAAE,MAAO,CAAAC,MAAM,GAAK,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAG,IAAI,CAC3EC,YAAY,CAAE,MAAO,CAAAH,MAAM,GAAK,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAAG,IAAI,CACzFE,IAAI,CAAE,CAAC,IAAM,CAAE,GAAI,CAAE,KAAM,CAAAC,CAAC,CAAGJ,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC,CAAE,MAAO,CAAAG,CAAC,CAAGC,IAAI,CAACC,KAAK,CAACF,CAAC,CAAC,CAAG,IAAI,CAAE,CAAE,MAAMG,CAAC,CAAE,CAAE,MAAO,KAAI,CAAE,CAAE,CAAC,EAAE,CAAC,CACrIC,MAAM,CAAE,MAAM,CACdC,KAAK,CAAE,IACT,CAAC,CAED,KAAM,CAAAC,SAAS,CAAGlC,WAAW,CAAC,CAC5BmC,IAAI,CAAE,MAAM,CACZd,YAAY,CACZe,QAAQ,CAAE,CACRC,cAAcA,CAACC,KAAK,CAAEC,MAAM,CAAE,CAC5B,KAAM,CAAEjB,KAAK,CAAEI,YAAY,CAAEC,IAAK,CAAC,CAAGY,MAAM,CAACC,OAAO,EAAI,CAAC,CAAC,CAC1DF,KAAK,CAAChB,KAAK,CAAGA,KAAK,EAAI,IAAI,CAC3BgB,KAAK,CAACZ,YAAY,CAAGA,YAAY,EAAI,IAAI,CACzCY,KAAK,CAACX,IAAI,CAAGA,IAAI,EAAI,IAAI,CACzB,GAAI,CAAE,GAAIL,KAAK,CAAEE,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAEnB,KAAK,CAAC,CAAC,IAAM,CAAAE,YAAY,CAACkB,UAAU,CAAC,OAAO,CAAC,CAAE,CAAE,MAAMC,CAAC,CAAE,CAAC,CAC1G,GAAI,CAAE,GAAIjB,YAAY,CAAEF,YAAY,CAACiB,OAAO,CAAC,cAAc,CAAEf,YAAY,CAAC,CAAC,IAAM,CAAAF,YAAY,CAACkB,UAAU,CAAC,cAAc,CAAC,CAAE,CAAE,MAAMC,CAAC,CAAE,CAAC,CACtI,GAAI,CAAE,GAAIhB,IAAI,CAAEH,YAAY,CAACiB,OAAO,CAAC,aAAa,CAAEZ,IAAI,CAACe,SAAS,CAACjB,IAAI,CAAC,CAAC,CAAC,IAAM,CAAAH,YAAY,CAACkB,UAAU,CAAC,aAAa,CAAC,CAAE,CAAE,MAAMC,CAAC,CAAE,CAAC,CACtI,CAAC,CACDE,SAASA,CAACP,KAAK,CAAE,CACfA,KAAK,CAAChB,KAAK,CAAG,IAAI,CAClBgB,KAAK,CAACZ,YAAY,CAAG,IAAI,CACzBY,KAAK,CAACX,IAAI,CAAG,IAAI,CACjBW,KAAK,CAACN,MAAM,CAAG,MAAM,CACrBM,KAAK,CAACL,KAAK,CAAG,IAAI,CAClB,GAAI,CAAET,YAAY,CAACkB,UAAU,CAAC,OAAO,CAAC,CAAElB,YAAY,CAACkB,UAAU,CAAC,cAAc,CAAC,CAAElB,YAAY,CAACkB,UAAU,CAAC,aAAa,CAAC,CAAE,CAAE,MAAMC,CAAC,CAAE,CAAC,CACvI,CACF,CAAC,CACDG,aAAa,CAAGC,OAAO,EAAK,CAC1BA,OAAO,CACJC,OAAO,CAACzC,SAAS,CAAC0C,OAAO,CAAGX,KAAK,EAAK,CAAEA,KAAK,CAACN,MAAM,CAAG,SAAS,CAAEM,KAAK,CAACL,KAAK,CAAG,IAAI,CAAE,CAAC,CAAC,CACxFe,OAAO,CAACzC,SAAS,CAAC2C,SAAS,CAAE,CAACZ,KAAK,CAAEC,MAAM,GAAK,CAC/CD,KAAK,CAACN,MAAM,CAAG,WAAW,CAC1B,KAAM,CAAEV,KAAK,CAAEI,YAAY,CAAEC,IAAK,CAAC,CAAGY,MAAM,CAACC,OAAO,EAAI,CAAC,CAAC,CAC1DF,KAAK,CAAChB,KAAK,CAAGA,KAAK,EAAI,IAAI,CAC3BgB,KAAK,CAACZ,YAAY,CAAGA,YAAY,EAAI,IAAI,CACzCY,KAAK,CAACX,IAAI,CAAGA,IAAI,EAAI,IAAI,CACzB,GAAI,CAAE,GAAIL,KAAK,CAAEE,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAEnB,KAAK,CAAC,CAAE,CAAE,MAAMqB,CAAC,CAAE,CAAC,CACnE,GAAI,CAAE,GAAIjB,YAAY,CAAEF,YAAY,CAACiB,OAAO,CAAC,cAAc,CAAEf,YAAY,CAAC,CAAE,CAAE,MAAMiB,CAAC,CAAE,CAAC,CACxF,GAAI,CAAE,GAAIhB,IAAI,CAAEH,YAAY,CAACiB,OAAO,CAAC,aAAa,CAAEZ,IAAI,CAACe,SAAS,CAACjB,IAAI,CAAC,CAAC,CAAE,CAAE,MAAMgB,CAAC,CAAE,CAAC,CACzF,CAAC,CAAC,CACDK,OAAO,CAACzC,SAAS,CAAC4C,QAAQ,CAAE,CAACb,KAAK,CAAEC,MAAM,GAAK,CAAED,KAAK,CAACN,MAAM,CAAG,QAAQ,CAAEM,KAAK,CAACL,KAAK,CAAGM,MAAM,CAACC,OAAO,EAAID,MAAM,CAACN,KAAK,CAACb,OAAO,CAAE,CAAC,CAAC,CACvI,CACF,CAAC,CAAC,CAEF,MAAO,MAAM,CAAEiB,cAAc,CAAEQ,SAAU,CAAC,CAAGX,SAAS,CAACkB,OAAO,CAC9D,cAAe,CAAAlB,SAAS,CAACmB,OAAO","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}