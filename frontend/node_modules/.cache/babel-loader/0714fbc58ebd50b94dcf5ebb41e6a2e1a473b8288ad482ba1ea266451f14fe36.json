{"ast":null,"code":"import React,{useEffect,useState}from'react';import axios from'./api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE=process.env.REACT_APP_API_URL||'http://localhost:3000';export default function LogList(_ref){let{token}=_ref;const[logs,setLogs]=useState([]);const[loading,setLoading]=useState(false);const[page,setPage]=useState(1);const[expanded,setExpanded]=useState(null);useEffect(()=>{fetchLogs(page);},[page]);// SSE: subscribe to new logs\nuseEffect(()=>{if(!token)return;const url=\"\".concat(API_BASE,\"/logs/stream?token=\").concat(encodeURIComponent(token));let es;try{es=new EventSource(url);}catch(err){console.warn('EventSource not available',err);return;}es.onmessage=e=>{try{const obj=JSON.parse(e.data);// prepend new log and expand it\nsetLogs(prev=>[obj,...prev]);setExpanded(obj._id);}catch(err){}};es.onerror=err=>{// console.warn('SSE error', err);\n};return()=>{try{es.close();}catch(_){}};},[token]);async function fetchLogs(){let p=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;setLoading(true);try{const res=await axios.get(\"\".concat(API_BASE,\"/logs?limit=200&page=\").concat(p));setLogs(res.data.items||[]);}catch(err){console.error('Fetch logs error',err);setLogs([]);}finally{setLoading(false);}}return/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:700},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Activity logs\"}),loading?/*#__PURE__*/_jsx(\"div\",{children:\"\\u0110ang t\\u1EA3i...\"}):/*#__PURE__*/_jsx(\"div\",{style:{maxHeight:600,overflow:'auto'},children:/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{width:180},children:\"Th\\u1EDDi gian\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:140},children:\"Ng\\u01B0\\u1EDDi d\\xF9ng (id)\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:140},children:\"H\\xE0nh \\u0111\\u1ED9ng\"}),/*#__PURE__*/_jsx(\"th\",{style:{width:140},children:\"IP\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Meta / Chi ti\\u1EBFt\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:logs.map(l=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"tr\",{onClick:()=>setExpanded(expanded===l._id?null:l._id),style:{cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"td\",{style:{whiteSpace:'nowrap'},children:new Date(l.timestamp).toLocaleString()}),/*#__PURE__*/_jsx(\"td\",{children:l.userId||'-'}),/*#__PURE__*/_jsx(\"td\",{children:l.action}),/*#__PURE__*/_jsx(\"td\",{children:l.ip||'-'}),/*#__PURE__*/_jsx(\"td\",{children:l.meta?typeof l.meta==='string'?l.meta:JSON.stringify(l.meta):''})]}),expanded===l._id&&/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:5,style:{padding:12},children:/*#__PURE__*/_jsx(\"pre\",{children:JSON.stringify(l,null,2)})})})]},l._id))})]})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:8},children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>setPage(p=>Math.max(1,p-1)),children:\"Previous\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn small\",onClick:()=>setPage(p=>p+1),children:\"Next\"})]})]});}","map":{"version":3,"names":["React","useEffect","useState","axios","jsx","_jsx","jsxs","_jsxs","API_BASE","process","env","REACT_APP_API_URL","LogList","_ref","token","logs","setLogs","loading","setLoading","page","setPage","expanded","setExpanded","fetchLogs","url","concat","encodeURIComponent","es","EventSource","err","console","warn","onmessage","e","obj","JSON","parse","data","prev","_id","onerror","close","_","p","arguments","length","undefined","res","get","items","error","style","minWidth","children","maxHeight","overflow","className","width","map","l","Fragment","onClick","cursor","whiteSpace","Date","timestamp","toLocaleString","userId","action","ip","meta","stringify","colSpan","padding","display","gap","justifyContent","marginTop","Math","max"],"sources":["d:/PM MNM/group11-project1/frontend/src/LogList.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport axios from './api';\r\n\r\nconst API_BASE = process.env.REACT_APP_API_URL || 'http://localhost:3000';\r\n\r\nexport default function LogList({ token }) {\r\n  const [logs, setLogs] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [page, setPage] = useState(1);\r\n  const [expanded, setExpanded] = useState(null);\r\n\r\n  useEffect(() => { fetchLogs(page); }, [page]);\r\n  // SSE: subscribe to new logs\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    const url = `${API_BASE}/logs/stream?token=${encodeURIComponent(token)}`;\r\n    let es;\r\n    try {\r\n      es = new EventSource(url);\r\n    } catch (err) {\r\n      console.warn('EventSource not available', err);\r\n      return;\r\n    }\r\n    es.onmessage = (e) => {\r\n      try {\r\n        const obj = JSON.parse(e.data);\r\n        // prepend new log and expand it\r\n        setLogs(prev => [obj, ...prev]);\r\n        setExpanded(obj._id);\r\n      } catch (err) {}\r\n    };\r\n    es.onerror = (err) => {\r\n      // console.warn('SSE error', err);\r\n    };\r\n    return () => { try { es.close(); } catch(_) {} };\r\n  }, [token]);\r\n\r\n  async function fetchLogs(p = 1) {\r\n    setLoading(true);\r\n    try {\r\n      const res = await axios.get(`${API_BASE}/logs?limit=200&page=${p}`);\r\n      setLogs(res.data.items || []);\r\n    } catch (err) {\r\n      console.error('Fetch logs error', err);\r\n      setLogs([]);\r\n    } finally { setLoading(false); }\r\n  }\r\n\r\n  return (\r\n    <div style={{minWidth:700}}>\r\n      <h3>Activity logs</h3>\r\n      {loading ? <div>Đang tải...</div> : (\r\n        <div style={{maxHeight:600, overflow:'auto'}}>\r\n          <table className=\"table\">\r\n            <thead>\r\n              <tr>\r\n                <th style={{width:180}}>Thời gian</th>\r\n                <th style={{width:140}}>Người dùng (id)</th>\r\n                <th style={{width:140}}>Hành động</th>\r\n                <th style={{width:140}}>IP</th>\r\n                <th>Meta / Chi tiết</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {logs.map(l => (\r\n                <React.Fragment key={l._id}>\r\n                  <tr onClick={() => setExpanded(expanded === l._id ? null : l._id)} style={{cursor:'pointer'}}>\r\n                    <td style={{whiteSpace:'nowrap'}}>{new Date(l.timestamp).toLocaleString()}</td>\r\n                    <td>{l.userId || '-'}</td>\r\n                    <td>{l.action}</td>\r\n                    <td>{l.ip || '-'}</td>\r\n                    <td>{l.meta ? (typeof l.meta === 'string' ? l.meta : JSON.stringify(l.meta)) : ''}</td>\r\n                  </tr>\r\n                  {expanded === l._id && (\r\n                    <tr>\r\n                      <td colSpan={5} style={{padding:12}}>\r\n                        <pre>{JSON.stringify(l, null, 2)}</pre>\r\n                      </td>\r\n                    </tr>\r\n                  )}\r\n                </React.Fragment>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n      <div style={{display:'flex',gap:8,justifyContent:'flex-end',marginTop:8}}>\r\n        <button className=\"btn small\" onClick={() => setPage(p => Math.max(1, p-1))}>Previous</button>\r\n        <button className=\"btn small\" onClick={() => setPage(p => p+1)}>Next</button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}